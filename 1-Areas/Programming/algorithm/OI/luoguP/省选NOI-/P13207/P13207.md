# P13207 [GCJ 2016 Finals] Family Hotel

## 题目描述

你经营着一家拥有 $\mathbf{N}$ 个房间的旅馆，这些房间沿着一条长走廊依次排列，编号为 $1$ 到 $\mathbf{N}$。你的客人都是大家庭，每个家庭到来时都会要求恰好两个相邻的房间。两个房间如果房号相差恰好为 $1$，则视为相邻。

今天一开始，旅馆是空的。你一直采用如下简单策略为客人分配房间：每当有家庭到来时，你会考虑所有当前仍然空闲且成对相邻的房间组合，从中等概率随机选择一对，将这两个房间分配给该家庭。新家庭会不断到来，每次只来一个，但一旦没有任何成对相邻且都空闲的房间，你就会亮起“无空房”标志，不再接待新客人。

现在，给定一个具体的房间号，问当你亮起“无空房”标志时，这个房间被占用的概率是多少？

## 输入格式

输入的第一行包含一个整数 $\mathbf{T}$，表示测试用例数量。接下来有 $\mathbf{T}$ 行，每行包含两个整数：房间总数 $\mathbf{N}$ 和你关心的房间号 $\mathbf{K}$。

## 输出格式

对于每组测试用例，输出一行 `Case #x: y`，其中 $x$ 为测试用例编号（从 1 开始），$y$ 为所求概率对 $10^9+7$ 取模后的值，具体定义如下。设房间 $\mathbf{K}$ 被占用的概率为最简分数 $\frac{p}{q}$，则 $y$ 应满足 $y \times q \equiv p \pmod{10^9+7}$，且 $y$ 在 $0$ 到 $10^9+6$ 之间。可以证明，在本题约束下，这样的 $y$ 总是存在且唯一。

## 输入输出样例 #1

### 输入 #1

```_
4
3 1
3 2
4 1
4 2
```

### 输出 #1

```_
Case #1: 500000004
Case #2: 1
Case #3: 666666672
Case #4: 1
```

## 说明/提示

.**样例解释**

在样例第 3 组中，共有 4 个房间，我们关心第 1 个房间被占用的概率。第一个家庭到来时，有 3 种可能的分配（每种概率为 $1/3$）：入住 $1+2$、$2+3$ 或 $3+4$。第一种情况下，第 1 个房间立即被占用且之后不会再变；第二种情况下，第 1 个房间空着，且无法再安排其他家庭，因此始终空着；第三种情况下，下一个到来的家庭必然入住 $1+2$，从而第 1 个房间也会被占用。因此第 1 个房间被占用的概率为 $2/3$，答案为 $666666672$，因为 $(666666672 \times 3) \bmod 1000000007 = 2 \bmod 1000000007$。

样例第 1 组的概率为 $1/2$，第 2 组和第 4 组的概率均为 $1$。

.**限制条件**

- $1 \leqslant \mathbf{T} \leqslant 100$。
- $1 \leqslant \mathbf{K} \leqslant \mathbf{N}$。

.**小数据集（10 分，测试集 1 - 可见）**

- $2 \leqslant \mathbf{N} \leqslant 10^4$。

.**大数据集（20 分，测试集 2 - 隐藏）**

- $2 \leqslant \mathbf{N} \leqslant 10^7$。

翻译由 GPT4.1 完成。

## 解析

>最后更新：2025-08-28 08:40

题目的意思可以理解为在一个长度为N的区间上随机覆盖长度为2的线段，求任意一点被覆盖的概率
我们只知道这个概率和N,K有关，目前不知道其余信息
先打表列出一部分结果值

打表过程中，我们发现了一部分性质:
每次放置时，对于长度为N的空腔，每个点作为开头的概率是 $\frac{1}{N-1}$ ,每个点被覆盖的概率为 $\frac{2}{N-1}$ 其中空腔头尾被覆盖的概率为其余点的一半
每次放置后，这个块将整片区域分为三块(左部，被覆盖部分，右部)，此时可以忽略目标点所在位置的区域  

即该点被覆盖的概率
$$
F(n,k)=p+L+R \\
\\
\begin{cases}
    p=\frac{2}{n-1}(k\neq n,k\neq 1) \\
    p=\frac{1}{n-1}(k = n | k = 1)
\end{cases} \\
\\
L=\frac{1}{N-1}F(n-2,k)+\frac{1}{N-1}F(n-3,k)...\frac{1}{N-1}F(k,k) \\
R=\frac{1}{N-1}F(n-2,k-2)+\frac{1}{N-1}F(n-3,k-3)...\frac{1}{N-1}F(n-k+1,1)
$$

再度优化，我们可以设 $此处点被覆盖的概率=\frac{该长度的总状态数-该点未被覆盖的状态数}{该长度的总状态数}$
但事实上该点未被覆盖的状态数并不好计算，有时会出现不同的摆放方式出现相同的图案
